
<!DOCTYPE html>
<html>

<head>
  <title>LiveEngage Configuration Tester "Chameleon"</title>
  <meta charset="UTF-8">
  <meta name="viewport"
    content="width=device-width, initial-scale=1.0,minimum-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
  <!-- Latest compiled and minified CSS -->
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css"
    integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
  <!-- Latest compiled and minified JavaScript -->
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"
    integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa"
    crossorigin="anonymous"></script>
  <script type="text/javascript">
    function getParameterByName(name, url) {
      if (!url) url = window.location.href;
      name = name.replace(/[\[\]]/g, "\\$&");
      var regex = new RegExp("[?&]" + name + "(=([^&#]*)|&|#|$)"),
        results = regex.exec(url);
      if (!results) return null;
      if (!results[2]) return '';
      return decodeURIComponent(results[2].replace(/\+/g, " "));
    }

    window.lpTag = window.lpTag || {}, "undefined" == typeof window.lpTag._tagCount ? (window.lpTag = {
      site: getParameterByName("site") || "",
      section: lpTag.section || "",
      tagletSection: lpTag.tagletSection || null,
      autoStart: lpTag.autoStart !== !1,
      ovr: lpTag.ovr || {},
      _v: "1.8.0",
      _tagCount: 1,
      protocol: "https:",
      events: { bind: function (t, e, i) { lpTag.defer(function () { lpTag.events.bind(t, e, i) }, 0) }, trigger: function (t, e, i) { lpTag.defer(function () { lpTag.events.trigger(t, e, i) }, 1) } },
      defer: function (t, e) { 0 == e ? (this._defB = this._defB || [], this._defB.push(t)) : 1 == e ? (this._defT = this._defT || [], this._defT.push(t)) : (this._defL = this._defL || [], this._defL.push(t)) },
      load: function (t, e, i) {
        var n = this;
        setTimeout(function () { n._load(t, e, i) }, 0)
      },
      _load: function (t, e, i) {
        var n = t;
        t || (n = this.protocol + "//" + (this.ovr && this.ovr.domain ? this.ovr.domain : "lptag.liveperson.net") + "/tag/tag.js?site=" + this.site);
        var a = document.createElement("script");
        a.setAttribute("charset", e ? e : "UTF-8"), i && a.setAttribute("id", i), a.setAttribute("src", n), document.getElementsByTagName("head").item(0).appendChild(a)
      },
      init: function () {
        this._timing = this._timing || {}, this._timing.start = (new Date).getTime();
        var t = this;
        window.attachEvent ? window.attachEvent("onload", function () { t._domReady("domReady") }) : (window.addEventListener("DOMContentLoaded", function () { t._domReady("contReady") }, !1), window.addEventListener("load", function () { t._domReady("domReady") }, !1)), "undefined" == typeof window._lptStop && this.load()
      },
      start: function () { this.autoStart = !0 },
      _domReady: function (t) { this.isDom || (this.isDom = !0, this.events.trigger("LPT", "DOM_READY", { t: t })), this._timing[t] = (new Date).getTime() },
      vars: lpTag.vars || [],
      dbs: lpTag.dbs || [],
      ctn: lpTag.ctn || [],
      sdes: lpTag.sdes || [],
      hooks: lpTag.hooks || [],
      ev: lpTag.ev || []
    }, lpTag.init()) : window.lpTag._tagCount += 1;

    // check section parameter
    var sectionParam = getParameterByName('section');
    var autoClickParam = getParameterByName('autoClick');
    console.log('get section from url parameter: ', sectionParam);
    console.log('get autoclick enabled from url parameter: ', autoClickParam);
    if (sectionParam !== null) {
      lpTag.section = sectionParam.split(',');
    } else {
      lpTag.section = ['test-page'];
    }
  </script>
</head>

<body>
  <div id="accordion" role="tablist" aria-multiselectable="true">
    <div class="panel panel-default">
      <div class="panel-heading" role="tab" id="headingOne">
        <h4 class="panel-title">
          <a role="button" data-toggle="collapse" data-parent="#accordion" href="#collapseOne" aria-expanded="true"
            aria-controls="collapseOne">
            LivePerson Configuration Tester "Chameleon" - v1.1
          </a>
        </h4>
      </div>
      <div id="collapseOne" class="collapse" role="tabpanel" aria-labelledby="headingOne">
        <div class="panel-body">
          <div id="intro_notes" style="padding: 15px 15px 5px">
            <a href="http://www.lpsandbox.com">http://www.lpsandbox.com</a>
            <br>
            <br> This an unofficial configuration testing page for your LivePerson account. It allows you to dynamically
            set the site ID and the section value of this page to trigger an engagment from your LivePerson account.
            <br>
            <br> You can change the settings (site ID and sections) using two methods:
            <br>
            <ol type="1">
              <li> Enter the LivePerson account number, click on "SET", enter each section value (1-9), click on
                "UPDATE" </li>
              <li> Pass the parameters via the URL i.e. <a
                  href="http://lpsandbox.com/?site=85946726&section=demo-page,test&autoClick=false">Click here for an
                  example</a></li>
            </ol>
            Notes:
            <br>
            <ul style="list-style-type:disc">
              <li>Auto Click Toggle is used for triggering the "Self-clicking" code. Leave it as unticked (i.e. OFF)
                unless specifically needed</li>
              <li>no "" (double quotes) required for section tags, tags are separated use , (comma) when using method 2
                to set section value</li>
            </ul>
          </div>
        </div>
      </div>
    </div>
  </div>
  <div class="row">
    <div class="col-md-6">
      <div style="padding:0px 15px 15px">
        <p class="lead">Page settings:</p>
        <div class="form-group">
          <div class="input-group" style="max-width: 200px">
            <input type="text" class="form-control" placeholder="Account Number" id="siteId" autocomplete="off">
            <span class="input-group-btn">
              <button class="btn btn-danger" type="button" onclick="setSiteID()">SET</button>
            </span>
          </div>
          <br />
          <div class="checkbox">
            <label>
              <input type="checkbox" id="autoClickEnabled"> Enable Auto-Click
            </label>
          </div>
          <div class="input-group" style="max-width: 200px">
            <span class="input-group-addon" id="basic-addon1">SECTION TAGS</span>
            <span class="input-group-btn"><button class="btn btn-primary" type="button"
                onclick="updateTags()">UPDATE</button></span>
          </div>
          <br />
          <div class="input-group" style="max-width: 300px">
            <span class="input-group-addon" id="basic-addon1">tag #1</span>
            <input type="text" class="form-control" placeholder="Section tag #1" id="sectionTag1" autocomplete="off">
          </div>
          <div class="input-group" style="max-width: 300px">
            <span class="input-group-addon" id="basic-addon1">tag #2</span>
            <input type="text" class="form-control" placeholder="Section tag #2" id="sectionTag2" autocomplete="off">
          </div>
          <div class="input-group" style="max-width: 300px">
            <span class="input-group-addon" id="basic-addon1">tag #3</span>
            <input type="text" class="form-control" placeholder="Section tag #3" id="sectionTag3" autocomplete="off">
          </div>
          <div class="input-group" style="max-width: 300px">
            <span class="input-group-addon" id="basic-addon1">tag #4</span>
            <input type="text" class="form-control" placeholder="Section tag #4" id="sectionTag4" autocomplete="off">
          </div>
          <div class="input-group" style="max-width: 300px">
            <span class="input-group-addon" id="basic-addon1">tag #5</span>
            <input type="text" class="form-control" placeholder="Section tag #5" id="sectionTag5" autocomplete="off">
          </div>
          <div class="input-group" style="max-width: 300px">
            <span class="input-group-addon" id="basic-addon1">tag #6</span>
            <input type="text" class="form-control" placeholder="Section tag #6" id="sectionTag6" autocomplete="off">
          </div>
          <div class="input-group" style="max-width: 300px">
            <span class="input-group-addon" id="basic-addon1">tag #7</span>
            <input type="text" class="form-control" placeholder="Section tag #7" id="sectionTag7" autocomplete="off">
          </div>
          <div class="input-group" style="max-width: 300px">
            <span class="input-group-addon" id="basic-addon1">tag #8</span>
            <input type="text" class="form-control" placeholder="Section tag #8" id="sectionTag8" autocomplete="off">
          </div>
          <div class="input-group" style="max-width: 300px">
            <span class="input-group-addon" id="basic-addon1">tag #9</span>
            <input type="text" class="form-control" placeholder="Section tag #9" id="sectionTag9" autocomplete="off">
          </div>
        </div>
      </div>
    </div>
    <div class="col-md-6">
      <div style="padding:0px 15px 15px">
        <p class="lead">Engagement Info</p>
        <div class="input-group" style="max-width: 300px">
          <span class="input-group-addon" id="basic-addon1">ID</span>
          <input type="text" class="form-control" placeholder="Engagement ID" id="engId" autocomplete="off">
          <div class="input-group-addon"><a id="consoleLink" href="#" target="_blank"
              title="Link works only when you are logged in to the LE console">OPEN</a></div>
        </div>
        <div class="input-group" style="max-width: 300px">
          <span class="input-group-addon" id="basic-addon1">NAME</span>
          <input type="text" class="form-control" placeholder="Engagement Name" id="engName" autocomplete="off">
        </div>
        <br />
        <div style="border-bottom: 1px solid #d6d6d6; width: 100%;"></div>
        <p class="lead">Conversation Info</p>
        <div class="input-group" style="max-width: 300px">
          <span class="input-group-addon" id="basic-addon1">State</span>
          <input type="text" class="form-control" placeholder="Conversation State" id="convState" autocomplete="off">
        </div>
        <div class="input-group" style="max-width: 300px">
          <span class="input-group-addon" id="basic-addon1">Skill</span>
          <input type="text" class="form-control" placeholder="Conversation Skill" id="convSkill" autocomplete="off">
        </div>
      </div>
    </div>
  </div>
  </div>
  <script type="text/javascript">
    $(document).ready(function () {
      // set site id
      $('#siteId').val(getParameterByName('site'));
      // set auto click enabled
      if (autoClickParam === 'true') {
        $('#autoClickEnabled').prop('checked', true);
      }
      // 
      registerAutoClick();
      registerWindowEvent();

      $('#consoleLink').tooltip();
      console.log('sections from lpTag: ', lpTag.section);
      if (Array.isArray(lpTag.section) && lpTag.section.length > 0) {
        for (var i = 0; i < lpTag.section.length; i++) {
          var inputId = '#sectionTag' + (i + 1);
          console.log('read ', inputId);
          $(inputId).val(lpTag.section[i]);
        }
      }
    });

    function setSiteID() {
      var url = location.origin + location.pathname;
      location.replace(url + "?site=" + $('#siteId').val());
    }

    function updateTags() {
      var newSection = [];
      for (var i = 0; i < 9; i++) {
        var inputId = '#sectionTag' + (i + 1);
        console.log('update ', inputId);
        var tag = $(inputId).val();
        if (tag !== '') {
          newSection.push(tag);
        }
      }

      lpTag.newPage(document.URL, {
        section: newSection
      });

      console.log('new section: ', lpTag.section);
    }

    function registerAutoClick() {
      var engagementId; // NOTE: The value of the var has to be an integer.
      lpTag.events.bind("LP_OFFERS", "OFFER_IMPRESSION", function (data) { //This is triggered when the engagement has been displayed on the page.
        console.log('engagement offered: ', data);
        if (data.engagementId && data.engagementName) {
          $('#engId').val(data.engagementId);
          $('#engName').val(data.engagementName);
          genConsoleLink(data.campaignId, data.engagementId);
        }
        if (data.state === 1 && data.engagementType === 6) {
          engagementId = data.engagementId;
          var checkForChat = setInterval(checkRendererStubReady, 500);

          function checkRendererStubReady() {

            if (lpTag && lpTag.taglets && lpTag.taglets.rendererStub) {
              var info = lpTag.taglets.rendererStub.getEngagementInfo(engagementId);
              if (info.state != "undefined" && info.state === 1) {
                console.log('Clicking the engagement: ', engagementId);
                var isAutoClickEnabled = $('#autoClickEnabled').prop('checked');
                console.log('Auto-Click Enabled: ', isAutoClickEnabled);
                if (isAutoClickEnabled) {
                  lpTag.taglets.rendererStub.click(engagementId);
                }
                clearInterval(checkForChat);
              }
            }
          }
        }
      });
    }

    function genConsoleLink(campId, engId) {
      // https://z3.le.liveperson.net/a/85946726/#camp!campaigns/web/667141451/engagement/web/667141651/studio
      var siteId = getParameterByName('site');
      var url = 'https://z3.le.liveperson.net/a/' + siteId + '/#camp!campaigns/web/' +
        campId + '/engagement/web/' + engId + '/studio';

      $('#consoleLink').prop('href', url);

    }

    function registerWindowEvent() {
      lpTag.events.bind('lpUnifiedWindow', 'conversationInfo', function (data) {
        console.log('conversation data:', data);

        if (data.state && data.skillName) {
          $('#convState').val(data.state);
          $('#convSkill').val(data.skillName);
        }
        if (data.engagementId && data.engagementName) {
          $('#engId').val(data.engagementId);
          $('#engName').val(data.engagementName);
          genConsoleLink(data.campaignId, data.engagementId);
        }

      });
    }
  </script>
</body>

</html>
